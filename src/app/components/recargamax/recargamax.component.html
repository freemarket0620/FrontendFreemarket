<div class="container mt-4">
  <h2 class="mb-3">Recarga Max</h2>

  <!-- ðŸ” BUSCADOR + BOTÃ“N -->
  <div class="row g-2 mb-3">
    <div class="col-12 col-md-6">
      <input
        type="text"
        class="form-control"
        placeholder="Buscar por nÃºmero origen o destino..."
        [(ngModel)]="searchText"
        (input)="filtrar()"
      />
    </div>

    <div class="col-12 col-md-6 text-md-end">
      <button
        class="btn btn-success w-100 w-md-auto"
        data-bs-toggle="modal"
        data-bs-target="#modalRegistrar"
      >
        + Nueva Recarga
      </button>
    </div>
  </div>

  <!-- ðŸ§® CALCULADORA 50% -->
  <div class="card p-3 mb-4">
    <h5 class="mb-2">Calculadora 50%</h5>
    <div class="row g-2 align-items-center">
      <div class="col-12 col-md-4">
        <input
          type="number"
          class="form-control"
          placeholder="Ingrese cantidad"
          inputmode="numeric"
          [(ngModel)]="cantidad"
          (input)="calcular50()"
        />
      </div>
      <div class="col-12 col-md-8">
        <strong>Total (cantidad + 50%):</strong>
        <span class="ms-2 text-success">
          {{ resultado50 | number : "1.2-2" }} Bs
        </span>
      </div>
    </div>
  </div>

  <!-- ðŸ“‹ TABLA -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-info">
        <tr>
          <th>ID</th>
          <th>NÂ° Origen</th>
          <th>Saldo</th>
          <th class="d-none d-md-table-cell">NÂ° Destino</th>
          <th class="d-none d-md-table-cell">Monto</th>
          <th>Estado</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let rec of recargasFiltradas">
          <td>{{ rec.id }}</td>
          <td>{{ rec.numero_origen }}</td>
          <td>{{ rec.saldo_total | number : "1.2-2" }}</td>
          <td class="d-none d-md-table-cell">
            {{ rec.numero_destino }}
          </td>
          <td class="d-none d-md-table-cell">
            {{ rec.monto_carga | number : "1.2-2" }}
          </td>
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-warning text-dark': rec.estado === 'PENDIENTE',
                'bg-success': rec.estado === 'COMPLETADO'
              }"
            >
              {{ rec.estado }}
            </span>
          </td>
          <td class="text-center">
            <div class="d-flex flex-column flex-md-row gap-1">
              <button
                class="btn btn-outline-primary btn-sm w-100"
                (click)="openSaldoModal(rec)"
              >
                Editar Saldo
              </button>
              <button
                class="btn btn-outline-success btn-sm w-100"
                (click)="openCargaModal(rec)"
              >
                Vender CrÃ©dito
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ================= MODAL REGISTRAR ================= -->
<div class="modal fade" id="modalRegistrar" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Registrar Nueva Recarga</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <div class="modal-body">
        <form
          [formGroup]="newRecargaForm"
          (ngSubmit)="registrarRecarga()"
          class="row g-2"
        >
          <div class="col-12 col-md-6">
            <label>NÃºmero Origen</label>
            <input
              type="text"
              formControlName="numero_origen"
              class="form-control"
            />
          </div>

          <div class="col-12 col-md-6">
            <label>Saldo Total (Bs)</label>
            <input
              type="number"
              inputmode="numeric"
              formControlName="saldo_total"
              class="form-control"
            />
          </div>

          <div class="col-12 col-md-6">
            <label>NÃºmero Destino</label>
            <input
              type="text"
              formControlName="numero_destino"
              class="form-control"
            />
          </div>

          <div class="col-12 col-md-6">
            <label>Monto Carga (Bs)</label>
            <input
              type="number"
              inputmode="numeric"
              formControlName="monto_carga"
              class="form-control"
            />
          </div>

          <div class="col-12 d-flex flex-column flex-md-row gap-2 mt-3">
            <button
              type="submit"
              class="btn btn-success w-100"
              [disabled]="newRecargaForm.invalid"
            >
              Registrar
            </button>
            <button
              type="button"
              class="btn btn-secondary w-100"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ================= MODAL SALDO ================= -->
<div class="modal fade" id="modalSaldo" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Editar Saldo</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <div class="modal-body" *ngIf="selectedRecarga">
        <form [formGroup]="saldoForm" (ngSubmit)="saveSaldo()">
          <div class="mb-2">
            <label>NÃºmero Origen</label>
            <input
              type="text"
              [value]="selectedRecarga.numero_origen"
              class="form-control"
              readonly
            />
          </div>

          <div class="mb-3">
            <label>Saldo Total (Bs)</label>
            <input
              type="number"
              inputmode="numeric"
              formControlName="saldo_total"
              class="form-control"
            />
          </div>

          <div class="d-flex flex-column flex-md-row gap-2">
            <button
              type="submit"
              class="btn btn-primary w-100"
              [disabled]="saldoForm.invalid"
            >
              Guardar
            </button>
            <button
              type="button"
              class="btn btn-secondary w-100"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ================= MODAL CARGA ================= -->
<div class="modal fade" id="modalCarga" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Vender CrÃ©dito</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <div class="modal-body" *ngIf="selectedRecarga">
        <form [formGroup]="cargaForm" (ngSubmit)="saveCarga()">
          <div class="mb-2">
            <label>NÃºmero Destino</label>
            <input
              type="text"
              formControlName="numero_destino"
              class="form-control"
            />
          </div>

          <div class="mb-3">
            <label>Monto de Carga (Bs)</label>
            <input
              type="number"
              inputmode="numeric"
              formControlName="monto_carga"
              class="form-control"
            />
          </div>

          <div class="d-flex flex-column flex-md-row gap-2">
            <button
              type="submit"
              class="btn btn-success w-100"
              [disabled]="cargaForm.invalid"
            >
              Guardar
            </button>
            <button
              type="button"
              class="btn btn-secondary w-100"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
